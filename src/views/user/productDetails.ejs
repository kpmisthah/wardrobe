<%-include('../../views/partials/userPartials/header')%>
<style>
  .flex-container {
    display: flex;
    gap: 10px; /* Adds some space between the buttons */
  }
  /* Style the Like button */
  .btn-like {
    background-color: #ff4d4d;
    color: #fff;
    font-size: 18px;
    padding: 10px 20px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.3s ease;
  }

  .btn-like:hover {
    background-color: #ff3333;
    transform: scale(1.1);
  }

  .btn-like i {
    margin-right: 8px;
  }

  .btn-like:focus {
    outline: none;
  }

  .imageZoom {
    width: 512px;
    height: 512px;
    border: 1px solid black;
    position: relative;
    /* margin-bottom: 20px; */
  }

  .imageZoom img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: 0 0;
    /* object-position: center; */
  }

  .imageZoom::after {
    display: var(--display);
    content: "";
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    background-image: var(--url);
    background-size: 500%;
    background-position: var(--zoom-x) var(--zoom-y);
    position: absolute;
    left: 0;
    top: 0;
  }
</style>
<!-- Product Detail -->
<section class="sec-product-detail bg0 p-t-65 p-b-60">
  <div class="container">
    <div class="row">
      <%products.forEach(value=>{%>
      <div class="col-md-6 col-lg-7 p-b-30">
        <div class="p-l-25 p-r-30 p-lr-0-lg">
          <div class="wrap-slick3 flex-sb flex-w">
            <div class="wrap-slick3-dots"></div>
            <div class="wrap-slick3-arrows flex-sb-m flex-w"></div>
            <div class="slick3 gallery-lb">
              <div
                class="item-slick3"
                data-thumb="/uploads/product-images/<%=value.productImage[0]%>"
              >
                <!-- <div class="wrap-pic-w pos-relative"> -->
                <div
                  id="imageZoom"
                  class="wrap-pic-w pos-relative imageZoom"
                  style="
											--url:url('/uploads/product-images/<%=value.productImage[0]%>');
											--zoom-x:0%,--zoom-y:0%;
											--display:none"
                >
                  <img
                    src="/uploads/product-images/<%=value.productImage[0]%>"
                    alt="IMG-PRODUCT"
                  />
                </div>
                <!-- <a class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04" href="/uploads/product-images/<%=value.productImage[0]%>">
												<i class="fa fa-expand"></i>
											</a> -->
                <!-- </div> -->
              </div>

              <div
                class="item-slick3"
                data-thumb="/uploads/product-images/<%=value.productImage[1]%>"
              >
                <!-- <div class="wrap-pic-w pos-relative"> -->
                <div
                  id="imageZoom"
                  class="wrap-pic-w pos-relative imageZoom"
                  style="
											--url:url('/uploads/product-images/<%=value.productImage[1]%>');
											--zoom-x:0%,--zoom-y:0%;
											--display:none"
                >
                  <img
                    src="/uploads/product-images/<%=value.productImage[1]%>"
                    alt="IMG-PRODUCT"
                  />
                </div>
                <!-- <a class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04" href="/uploads/product-images/<%=value.productImage[1]%>">
												<i class="fa fa-expand"></i>
											</a> -->
                <!-- </div> -->
              </div>

              <div
                class="item-slick3"
                data-thumb="/uploads/product-images/<%=value.productImage[2]%>"
              >
                <div class="wrap-pic-w pos-relative">
                  <div
                    id="imageZoom"
                    class="wrap-pic-w pos-relative imageZoom"
                    style="--url:url('/uploads/product-images/<%=value.productImage[2]%>')--zoom-x:0%,--zoom-y:0%;--display:none"
                  >
                    <img
                      src="/uploads/product-images/<%=value.productImage[2]%>"
                      alt="IMG-PRODUCT"
                    />
                  </div>
                  <a
                    class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04"
                    href="/uploads/product-images/<%=value.productImage[2]%>"
                  >
                    <i class="fa fa-expand"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-5 p-b-30">
        <div class="p-r-50 p-t-5 p-lr-0-lg">
          <h4 class="mtext-105 cl2 js-name-detail p-b-14"><%=value.name%></h4>

          <span class="mtext-106 cl2"> <%=value.salePrice%> </span>
          <br />
          <span class="mtext-106 cl2">
            <%if(!value.category.categoryOffer){%> No Offers <%}else{%>
            <%=value.category.categoryOffer%>% Offer <%}%>
          </span>

          <p class="stext-102 cl3 p-t-23"><%=value.description%></p>

          <!--  -->

          <!-- Available Sizes and Stock Table -->
                                                                                                                                                                                   
          <div class="p-t-33">
            <div class="flex-w flex-r-m p-b-10">
              <div class="size-203 flex-c-m respon6">Size</div>

              <div class="size-204 respon6-next">
                <div class="rs1-select2 bor8 bg0">
                  <select class="js-select2" name="time">
                    <option>Choose an option</option>
                    <% value.sizeOptions.forEach(option => { %>
                    <option><%= option.size %></option>
                    <% }) %>
                  </select>
                  <div class="dropDownSelect2"></div>
                </div>
              </div>
            </div>

            <div class="flex-w flex-r-m p-b-10">
              <div class="size-204 flex-w flex-m respon6-next">
                <div class="wrap-num-product flex-w m-r-20 m-tb-10">
                  <div
                    class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m"
                  >
                    <i class="fs-16 zmdi zmdi-minus"></i>
                  </div>

                  <input
                    class="mtext-104 cl3 txt-center num-product"
                    type="number"
                    name="num-product"
                    value="1"
                  />                
                  <div
                    class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m"
                  >
                    <i class="fs-16 zmdi zmdi-plus"></i>
                  </div>
                </div>
                <input type="hidden" id="product_id" value="<%= value._id %>">
                <div class="flex-container">
                  <!-- Go to cart button -->
                  <button
                    class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 js-addcart-detail"
                    onclick="addToCart('<%=value._id%>','<%=value.name%>','<%=value.salePrice%>',document.querySelector('.num-product').value,document.querySelector('.js-select2').value)"
                  >
                    Go to cart
                  </button>

                  <!-- Like button with emoji -->
                  <button
                    class="btn-like"
                    onclick="likeProduct('<%=value._id%>', document.querySelector('.js-select2').value, document.querySelector('.num-product').value)"
                  >
                    <i class="fa fa-heart"></i> Like
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="p-t-33">
            <div class="flex-w flex-r-m p-b-10">
              <div class="size-203 flex-c-m respon6"></div>
              <div class="size-204 respon6-next">
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>Size</th>
                      <th>Stock Left</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% value.sizeOptions.forEach(option => { %>
                    <tr>
                      <td><%= option.size %></td>
                      <td><%= option.quantity %></td>
                    </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <%})%>
        </div>
      </div>
    </div>

    <div class="bor10 m-t-50 p-t-43 p-b-40">
      <!-- Tab01 -->
      <div class="tab01">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item p-b-10">
            <a
              class="nav-link active"
              data-toggle="tab"
              href="#description"
              role="tab"
              >Description</a
            >
          </li>

          <li class="nav-item p-b-10">
            <a class="nav-link" data-toggle="tab" href="#information" role="tab"
              >Additional information</a
            >
          </li>

          <li class="nav-item p-b-10">
            <a class="nav-link" data-toggle="tab" href="#reviews" role="tab"
              >Reviews </a
            >
          </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content p-t-43">
          <!-- - -->
          <div
            class="tab-pane fade show active"
            id="description"
            role="tabpanel"
          >
            <div class="how-pos2 p-lr-15-md">
              <%products.forEach((value)=>{%>
                <p class="stext-102 cl6">
                  <%=value.description%>
                </p>
                <%})%>
            </div>
          </div>

          <!-- - -->
          <div class="tab-pane fade" id="reviews" role="tabpanel">
            <div class="row">
              <div class="col-sm-10 col-md-8 col-lg-6 m-lr-auto">
                <div class="p-b-30 m-lr-15-sm">
                  <!-- Review -->
                  <%review.forEach((review)=>{%>
                  <div class="flex-w flex-t p-b-68">
                    <div class="size-207">
                      <div class="flex-w flex-sb-m p-b-17">
                        <span class="mtext-107 cl2 p-r-20">
                          <%=review.userId.name%>
                        </span>


                        <span class="fs-18 cl11">
                          <% 
                          const rating = review.rating; 
                          for (let i = 1; i <= 5; i++) { 
                          %>
                            <i class="zmdi zmdi-star <%= i <= rating ? 'star-colored' : '' %>"></i>
                          <% } %>
                        </span>
                      </div>
                      <p class="stext-102 cl6">
                      <%=review.review%>
                      </p>
                    </div>
                  </div>
                  <%})%>

                  <!-- Add review -->
                  <form class="w-full" id="review-form" onsubmit="handleReviewSubmit(event)">
                    <h5 class="mtext-108 cl2 p-b-7">Add a review</h5>

                    <div class="flex-w flex-m p-t-50 p-b-23">
                      <span class="stext-102 cl3 m-r-16"> Your Rating </span>

                      <span class="wrap-rating fs-18 cl11 pointer">
                        <i
                          class="item-rating pointer zmdi zmdi-star-outline"
                        ></i>
                        <i
                          class="item-rating pointer zmdi zmdi-star-outline"
                        ></i>
                        <i
                          class="item-rating pointer zmdi zmdi-star-outline"
                        ></i>
                        <i
                          class="item-rating pointer zmdi zmdi-star-outline"
                        ></i>
                        <i
                          class="item-rating pointer zmdi zmdi-star-outline"
                        ></i>
                        <input class="dis-none" type="number" name="rating" />
                      </span>
                    </div>

                    <div class="row p-b-25">
                      <div class="col-12 p-b-5">
                        <label class="stext-102 cl3" for="review"
                          >Your review</label
                        >
                        <textarea
                          class="size-110 bor8 stext-102 cl2 p-lr-20 p-tb-10"
                          id="review"
                          name="review"
                        ></textarea>
                      </div>
                    </div>

                    <button
                      class="flex-c-m stext-101 cl0 size-112 bg7 bor11 hov-btn3 p-lr-15 trans-04 m-b-10"
                    >
                      Submit
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</section>

<script>
  let imageZoomElements = document.querySelectorAll(".imageZoom");

  imageZoomElements.forEach((imageZoom) => {
    imageZoom.addEventListener("mousemove", (event) => {
      imageZoom.style.setProperty("--display", "block");
      let pointer = {
        x: (event.offsetX * 100) / imageZoom.offsetWidth,
        y: (event.offsetY * 100) / imageZoom.offsetHeight,
      };
      imageZoom.style.setProperty("--zoom-x", pointer.x + "%");
      imageZoom.style.setProperty("--zoom-y", pointer.y + "%");
    });

    imageZoom.addEventListener("mouseout", () => {
      imageZoom.style.setProperty("--display", "none");
    });
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/javascript/cart.js"></script>
<script src="/javascript/reviews.js"></script>
<%-include('../../views/partials/userPartials/footer')%>
